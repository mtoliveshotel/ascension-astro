---
const API_URL = 'https://api.ascension.tours/send.php';
---

<form id="contact" class="contact" novalidate>
  <div class="field">
    <label for="name">Name</label>
    <input id="name" name="name" required minlength="2" maxlength="100" autocomplete="name" />
    <div class="err" data-for="name"></div>
  </div>

  <div class="field">
    <label for="email">Email</label>
    <input id="email" name="email" type="email" required maxlength="254" inputmode="email" dir="ltr" autocomplete="email" />
    <div class="err" data-for="email"></div>
  </div>

  <div class="field">
    <label for="message">Message</label>
    <textarea id="message" name="message" required minlength="10" maxlength="4000" rows="5"></textarea>
    <div class="err" data-for="message"></div>
  </div>

  <!-- Honeypot (bots fill this; humans don't) -->
  <input type="text" name="hp" tabindex="-1" autocomplete="off"
         style="position:absolute;left:-9999px;opacity:0" aria-hidden="true" />

  <button type="submit" class="btn" data-state="idle">Send</button>
  <p id="status" aria-live="polite" style="margin-top:.75rem;"></p>
  <noscript><p>Please enable JavaScript to send the form.</p></noscript>
</form>

<style>
  .contact .field { margin-bottom: 12px; }
  .contact label { display:block; font-weight:600; margin-bottom:4px; }
  .contact input, .contact textarea {
    width:100%; padding:10px; border:1px solid #e5e7eb; border-radius:8px; font:inherit;
  }
  .contact .err { color:#b91c1c; font-size:12px; min-height:1em; }
  .contact .btn { margin-top:8px; }
</style>

<script>
  (function () {
    const form = document.querySelector('#contact');                 // matches your <form id="contact">
    const status = document.querySelector('#status');                // reuse the existing status <p>
    const submitBtn = form?.querySelector('button[type="submit"]'); // define the button

    if (!form || !status) return;

    form.addEventListener('submit', async (e) => {

      console.log('[contact] submit fired');

      e.preventDefault();
      status.textContent = 'Sending…';
      submitBtn?.setAttribute('disabled', '');


try {
  console.log('[contact] posting to', API_URL);

  const res = await fetch(API_URL, {
    method: 'POST',
    body: new FormData(form),
    // defaults are fine; keeping it simple reduces preflight risk
    // mode: 'cors',
    // credentials: 'omit',
  });

  console.log('[contact] fetch status', res.status);

  const data = await res.json().catch(() => ({}));
  console.log('[contact] response body', data);

  if (!res.ok || data.ok === false) {
    status.textContent = 'Error: ' + (data.error || ('HTTP ' + res.status));
  } else {
    status.textContent = 'Thanks — your message was sent.';
    form.reset();
  }
} catch (err) {
  console.error('[contact] fetch error', err);
  status.textContent = 'JS error: ' + (err?.message || err);
} finally {
  submitBtn?.removeAttribute('disabled');
}










    });
  })();
</script>

