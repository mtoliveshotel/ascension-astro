---
const API_URL = 'https://api.ascension.tours/contact.php';
---

<form id="contact" class="contact" novalidate>
  <div class="field">
    <label for="name">Name</label>
    <input id="name" name="name" required minlength="2" maxlength="100" autocomplete="name" />
    <div class="err" data-for="name"></div>
  </div>

  <div class="field">
    <label for="email">Email</label>
    <input id="email" name="email" type="email" required maxlength="254" inputmode="email" dir="ltr" autocomplete="email" />
    <div class="err" data-for="email"></div>
  </div>

  <div class="field">
    <label for="message">Message</label>
    <textarea id="message" name="message" required minlength="10" maxlength="4000" rows="5"></textarea>
    <div class="err" data-for="message"></div>
  </div>

  <!-- Honeypot (bots fill this; humans don't) -->
  <input type="text" name="hp" tabindex="-1" autocomplete="off"
         style="position:absolute;left:-9999px;opacity:0" aria-hidden="true" />

  <button type="submit" class="btn" data-state="idle">Send</button>
  <p id="status" aria-live="polite" style="margin-top:.75rem;"></p>
  <noscript><p>Please enable JavaScript to send the form.</p></noscript>
</form>

<style>
  .contact .field { margin-bottom: 12px; }
  .contact label { display:block; font-weight:600; margin-bottom:4px; }
  .contact input, .contact textarea {
    width:100%; padding:10px; border:1px solid #e5e7eb; border-radius:8px; font:inherit;
  }
  .contact .err { color:#b91c1c; font-size:12px; min-height:1em; }
  .contact .btn { margin-top:8px; }
</style>

<script>
  // Minimal debug: intercept the form submit and ping the API
  (function () {
    const form = document.querySelector('form');             // only form on page
    const status = document.createElement('p');
    status.id = 'form-debug';
    status.style.marginTop = '8px';
    status.style.fontSize = '12px';
    status.style.opacity = '0.8';
    form?.appendChild(status);

    const form = document.querySelector('#contact-form');
    if (!form) return;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
    
      submitBtn.disabled = true;
      status.textContent = 'Sending…';
    
      try {
        const res = await fetch('https://api.ascension.tours/contact.php', {
          method: 'POST',
          body: new FormData(form),
          mode: 'cors',
          credentials: 'omit',
        });
    
        if (!res.ok) throw new Error('bad status ' + res.status);
    
        status.textContent = 'Thanks — your message was sent.';
        form.reset();
      } catch (err) {
        status.textContent = 'Sorry — could not send. Please try again in a minute.';
      } finally {
        submitBtn.disabled = false;
      }
    });




  })();
</script>

